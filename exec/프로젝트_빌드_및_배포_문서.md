# í”„ë¡œì íŠ¸ ë¹Œë“œ ë° ë°°í¬



## âš™ ì‹œìŠ¤í…œ í™˜ê²½ ë° êµ¬ì„±

- OS: Windows10
- Backend Framework: Spring Boot 2.4.5
- Frontend Framework: React
- DB: mysql Ver 8.0.27 for Win64 on x86_64 (MySQL Community Server - GPL)
- WAS: Gradle
- JVM: openJDK (1.8.0_192)
- Node.js: 16.14
- Docker: 20.10.12
- WEB: Nginx (1.18.0)

<br/>

## ğŸªDB ì ‘ì† ì •ë³´ ë° í”„ë¡œí¼í‹°



###  Database ì ‘ê·¼

> ID: ssafy
>
> PW: ssafy1234



<h3> Database í”„ë¡œí¼í‹°

</h3>

application.yml 

![ì‹¤í–‰í™”ë©´ìº¡ì³](./ì‚°ì¶œë¬¼/DBproperties01.png)

ì—”í‹°í‹°ì˜ ë³€ê²½ë¶„ë§Œ DBì— ë°˜ì˜



![ì‹¤í–‰í™”ë©´ìº¡ì³](./ì‚°ì¶œë¬¼/DBproperties02.png)

database url, driver-class-name, username, password ë° ê¸°íƒ€ ì •ë³´ë¥¼ ì½ì–´ë“¤ì„



### ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ í˜‘ì—… íˆ´

------

- Git

- Jira

- Notion

- Discord

- Mattermost

- Webex

  

## **2. ë°°í¬ ìˆœì„œ**

##### **Ubuntuì— ë„ì»¤ ì„¤ì¹˜**

```
sudo apt-get update
```

```
# í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
$ sudo apt-get install \
       apt-transport-https \
       ca-certificates \
       curl \
       gnupg \
       lsb-release
```

```
# GPG Key ì¸ì¦
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
```

```
# docker repository ë“±ë¡
$ sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $ (lsb_release -cs) stable"
```

```
# ë„ì»¤ ì„¤ì¹˜
$ sudo apt-get update
$ sudo apt-get install docker-ce docker-ce-cli containerd.io

# ë„ì»¤ í™•ì¸
sudo service docker status
```

**![ì‹¤í–‰í™”ë©´ìº¡ì³](./ì‚°ì¶œë¬¼/ë„ì»¤ìƒíƒœí™•ì¸.png)**

#### ë„ì»¤ ëª…ë ¹ì–´

- ë„ì»¤ ì»¨í…Œì´ë„ˆ ë³´ëŠ” ë²•
  - sudo docker ps -a
- ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‚­ì œ
  - sudo docker rm <container_id>
- ë„ì»¤ ì´ë¯¸ì§€ ë³´ëŠ” ë²•
  - sudo docker images
- ë„ì»¤ ì´ë¯¸ì§€ ì‚­ì œ
  - sudo docker rmi <image_id>
- ê°•ì œ ì˜µì…˜ -f (ì‚­ì œê°€ ì•ˆë  ë•Œ,)
  - ex) docker rmi -f <image_id>
- ë„ì»¤ ë¡œê·¸ í™•ì¸
  - docker logs <image_id> : ë„ì»¤ê°€ êº¼ì ¸ìˆì–´ë„(ì»¨í…Œì´ë„ˆê°€) ìµœì¢…ì ìœ¼ë¡œ ì‹¤í–‰ëœ ê¸°ë¡ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤(ì˜¤ë¥˜ ì¡ì„ ë•Œ, ë§¤ìš° ìœ ìš©)

##### **docker ë„¤íŠ¸ì›Œí¬ ì„¤ì •**

ê°™ì€ Docker Hostë‚´ì—ì„œ ì‹¤í–‰ì¤‘ì¸ Containerê°„ ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ë…¼ë¦¬ì  **ë„¤íŠ¸ì›Œí¬**ê°™ì€ ê°œë…ì…ë‹ˆë‹¤. ì„œë¡œ ê°„ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. nginxë¥¼ í†µí•œ front, backend í†µì‹ ì„ ìœ„í•´ ì„¤ì •í•©ë‹ˆë‹¤.

```
sudo docker network create thxstorecicdnetwork
```



### (1). í˜„ì¬ ë°©í™”ë²½ ì„¤ì • í™•ì¸

```bash
1. sudo ufw status 
```

#####  **# ufwê°€ inactiveìœ¼ë¡œ ë˜ì–´ ìˆë‹¤ë©´ SSH í¬íŠ¸ë¥¼ í†µí•œ ì ‘ì† í—ˆìš© í›„ ë°©í™”ë²½ ì„¤ì •í•˜ê¸°  ( ê¼­ ì´ ìˆœì„œë¡œ í•  ê²ƒ )** 

```
1. sudo ufw allow 22 
2. sudo ufw enable
```



### (2). EC2ì— MySQL ì„¤ì¹˜ ë° ì„¸íŒ…

```
# ë‹¤ìŒ ëª…ë ¹ì–´ë“¤ì„ ì³ì„œ MySQLì„ ì„¤ì¹˜í•œë‹¤.
sudo apt-get update
sudo apt-get install mysql-server
```

```
# MySQL êµ¬ë™ì„ í•œë‹¤.
sudo systemctl start mysql.service
```

```
# ì—¬ê¸°ì„œ ë³´ì•ˆì„ ë” ë†’ì´ê³  ì‹¶ë‹¤ë©´ ë³´ì•ˆ ìœ„í—˜ì´ ìˆëŠ” ë””í´íŠ¸ ê°’ë“¤ì˜ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ”
# mysql_secure_installation ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•œë‹¤.
sudo docker exec -it ssafydb bash
```

```
# MySQL ì ‘ì†
$ sudo mysql
â— ì•„ë˜ì˜ ì¿¼ë¦¬ë¥¼ ì³ë³´ë©´ í˜„ì¬ mysqlì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì„¸íŒ… ë˜ì–´ìˆëŠ” ìœ ì € ë“¤ë§Œ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
  mysql > SELECT user,authentication_string,plugin,host FROM mysql.user;
```

![ì‹¤í–‰í™”ë©´ìº¡ì³](./ì‚°ì¶œë¬¼/ê¸°ë³¸ìœ¼ë¡œ ì…‹íŒ…ëœ ìœ ì € ì¡°íšŒ.png)

**â— ìš°ë¦¬ê°€ ì‚¬ìš©í•  ìƒˆë¡œìš´ ìœ ì €ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ ìƒˆë¡œìš´ ê³„ì •ì„ ìƒì„±í•˜ê³  GRANT ì¿¼ë¦¬ë¡œ í•„ìš”í•œ ê¶Œí•œë“¤ì„ ë¶€ì—¬í•œë‹¤.**

**â— ì•„ë˜ ì¿¼ë¦¬ëŠ” ìƒˆë¡œìš´ ê³„ì •ì— ëª¨ë“  ê¶Œí•œì„ ë¶€ì—¬í•´ì¤€ë‹¤. % ëŠ” ì–´ë– í•œ ipë¡œë„ ì ‘ì†ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ëœ»ì´ë‹¤.**

**â— ìœ ì € ì¶”ê°€ í›„ ë‹¤ì‹œ ìœ„ì˜ ì¿¼ë¦¬ë¥¼ ì³ë³´ë©´ ìœ ì €ê°€ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.**

```
mysql> CREATE USER 'ê³„ì •ì´ë¦„'@'%' IDENTIFIED BY 'ë¹„ë°€ë²ˆí˜¸';
mysql> GRANT ALL PRIVILEGES ON . TO 'ê³„ì •ì´ë¦„'@'%' WITH GRANT OPTION;
mysql> FLUSH PRIVILEGES;
```



### (3). MySQL Workbench ì„¤ì¹˜í•´ì„œ EC2ì— ìˆëŠ” DBì™€ ì—°ê²°í•˜ê¸°

```
íš¨ìœ¨ì ì¸ í˜‘ì—…ì„ ìœ„í•´ ë¡œì»¬ì— Workbenchë¥¼ ì„¤ì¹˜í•´ì„œ EC2ì™€ ì—°ë™í•œë‹¤. 
ì´ë ‡ê²Œ í•˜ë©´ ëª¨ë“  íŒ€ì›ì´ ê°œë°œì€ ë¡œì»¬ë¡œ í•˜ë©´ì„œë„ DBë¥¼ ê³µìœ í•  ìˆ˜ ìˆì–´ í¸ë¦¬í•˜ë‹¤.
```

 **ì™¸ë¶€ ì ‘ì†ì„ í—ˆìš©í•˜ê¸° ìœ„í•œ ì„¤ì •ì„ í•œë‹¤.   EC2 ì„œë²„ì—ì„œ /etc/mysql/mysql.conf.d ë¡œ ì´ë™í•´ì„œ vi mysqld.cnf ë¥¼ ì‹¤í–‰í•´ì¤€ë‹¤.**

```
 ì™¸ë¶€ ì ‘ì†ì„ í—ˆìš©í•˜ê¸° ìœ„í•œ ì„¤ì •ì„ í•œë‹¤.
 EC2 ì„œë²„ì—ì„œ /etc/mysql/mysql.conf.d ë¡œ ì´ë™í•´ì„œ vi mysqld.cnf ë¥¼ ì‹¤í–‰í•´ì¤€ë‹¤.
```

**vi ì—ë””í„°ì—ì„œ i ë¥¼ ëˆŒëŸ¬ bind-address ë¥¼ 0.0.0.0 ìœ¼ë¡œ ìˆ˜ì •í•´ì¤€ í›„ ì €ì¥í•˜ê³  ë‚˜ê°„ë‹¤.**

![ì‹¤í–‰í™”ë©´ìº¡ì³](./ì‚°ì¶œë¬¼/mysql_bindaddressìˆ˜ì •.png)

â— **ë°©í™”ë²½ì—ì„œ MySQLì´ ì‚¬ìš©í•˜ê²Œ ë  3306 í¬íŠ¸ë¥¼ ì—´ì–´ì¤€ë‹¤.**

```
# ë°©í™”ë²½ ì„¤ì • (í¬íŠ¸ 3306 ì˜¤í”ˆ)
$ sudo ufw allow 3306
```

â— MySQLì„ ì¬ì‹œì‘í•´ì¤€ë‹¤.

```
$ sudo systemctl restart mysql.service
```

 â— MySQL Workbenchë¥¼ **ë¡œì»¬ì— ì„¤ì¹˜**í•´ì¤€ë‹¤.  

  ì„¤ì¹˜ê°€ ëë‚˜ë©´ ì‹¤í–‰í•´ì„œ ìƒˆë¡œìš´ connectionì„ ì¶”ê°€í•´ ì¤€ë‹¤. 

 â—  Connection Name ì—ëŠ” ì›í•˜ëŠ” ì»¤ë„¥ì…˜ëª…ì„, Hostname ì—ëŠ” ì ‘ì†í•  ì£¼ì†Œë¥¼,   

â€‹     Username ì—ëŠ” ì•„ê¹Œ ìƒì„±í•œ MySQL ê³„ì •ì˜ ìœ ì €ë„¤ì„ì„ ì…ë ¥í•˜ê³  OKë¥¼ ëˆ„ë¥¸ë‹¤.

 â— ì ‘ì† ì‹œ ì•„ê¹Œ ìƒì„±í•œ ìœ ì €ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´ ì—°ê²°ì´ ë˜ì–´    workbenchì—ì„œ EC2ì— ì˜¬ë¦° DBë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ëœë‹¤.



### **(4). HTTPS í‚¤ ë°œê¸‰**

frontendì—ì„œëŠ” sslì´ ì ìš©ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— HTTPS ì¸ì¦ì„ ë°›ì•„ì•¼í•©ë‹ˆë‹¤.

```
# letsencrypt ì„¤ì¹˜í•˜ê¸°
sudo apt-get update
sudo apt-get install letsencrypt

# ë§Œì•½ nginxë¥¼ ì‚¬ìš©ì¤‘ì´ë©´ ì¤‘ì§€
sudo systemctl stop nginx

# ì¸ì¦ì„œ ë°œê¸‰
# sudo letsencrypt certonly --standalone -d ë„ë©”ì¸[i6íŒ€ID.p.ssafy.io]
sudo letsencrypt certonly --standalone -d i6e103.p.ssafy.io
# ìì‹ ì˜ ì´ë©”ì¼ ì“°ê³  Agree
# ë‰´ìŠ¤ë ˆí„° no
# í‚¤ê°€ ë°œê¸‰ë˜ëŠ”ë° ì´ ë‘ ê°€ì§€ë¥¼ ì¨ì•¼í•©ë‹ˆë‹¤. ë°‘ì˜ ê²½ë¡œì— ê°ê° í•˜ë‚˜ì”© ìˆìŠµë‹ˆë‹¤.
 ssl_certificate /etc/letsencrypt/live/ë„ë©”ì¸ì´ë¦„/fullchain.pem; 
 ssl_certificate_key /etc/letsencrypt/live/ë„ë©”ì¸ì´ë¦„/privkey.pem; 
 
# ì¸ì¦ì„œ ìœ„ì¹˜ í´ë” ì´ë™
cd /etc/letsencrypt/live/ë„ë©”ì¸

# pemì„ PKCS12 í˜•ì‹ìœ¼ë¡œ ë³€ê²½
openssl pkcs12 -export -in fullchain.pem -inkey privkey.pem -out keystore.p12 -name airpageserver -CAfile chain.pem -caname root

# ì¸ì¦ì„œ ë³µì‚¬
# ì¸ì¦ì„œ ë³´ê´€ í´ë”ë¥¼ ë¯¸ë¦¬ ìƒì„±í•´ ì£¼ì„¸ìš”.
# sudo cp [íŒŒì¼ì´ë¦„] [ì¸ì¦ì„œë¥¼ ë³´ê´€ í•  docker volume í´ë”] 
# ì•„ë˜ëŠ” ì˜ˆì‹œ

sudo cp fullchain.pem /home/ubuntu/docker-volume/ssl
sudo cp privkey.pem /home/ubuntu/docker-volume/ssl
sudo cp keystore.p12 /home/ubuntu/docker-volume/ssl

```



í”„ë¡œì íŠ¸ëŠ” docker-compose ë¥¼ ì‚¬ìš©í•´ ë¹Œë“œì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  **ì»¨í…Œì´ë„ˆë¡œ ë°°í¬í•˜ëŠ” ë°©ì‹**ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.



### (5). ë¹Œë“œ ë° ë°°í¬

> í”„ë¡œì íŠ¸ì˜ **root ê²½ë¡œì— ìˆëŠ” docker-composeë¥¼** `docker-compose up` ëª…ë ¹ì–´ë¡œ ì‹¤í–‰í•´ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ë¹Œë“œ ë° ë°°í¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.

#### docker-compose.yml

```
version: '3.2'

services:
  frontend:
    image: frontend
    build:
      context: front/
      dockerfile: Dockerfile
    ports:
      - "80:80"
      - "443:443"
    # [ì¸ì¦ì„œ íŒŒì¼ ì €ì¥ ê²½ë¡œ]:/var/www/html
    volumes:
      - /home/ubuntu/docker-volume:/var/www/html
    container_name: "frontend"
    networks:
      - helf

  backend:
    image: backend-spring
    build:
      context: back/
      dockerfile: Dockerfile
    ports:
      - "8443:8443"
      # [ì¸ì¦ì„œ íŒŒì¼ ì €ì¥ ê²½ë¡œ]:/root
    volumes:
      - /home/ubuntu/docker-volume:/root
    container_name: "backend"
    networks:
      - helf

networks:
  helf:

```



# ğŸ—ƒ í¬íŠ¸ ë²ˆí˜¸

```
FrontEnd: 80
BackEnd: 8443
Jenkins: 9090
Database: 3306
```



## í”„ë¡ íŠ¸ì—”ë“œ Dockerfile

> ë¹Œë“œìš© ì´ë¯¸ì§€ì™€ ë°°í¬ìš© ì´ë¯¸ì§€ë¥¼ ë¶„ë¦¬í•´ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì˜€ìŠµë‹ˆë‹¤.

### dockerfile

```
FROM node:16 as build-stage
WORKDIR /app
ADD . .
RUN npm install
RUN npm run build

FROM nginx:stable-alpine as production-stage
#ì»¨í…Œì´ë„ˆ ì•ˆì— nginx.confë¥¼ ì˜† í•´ë‹¹ê²¨ë¡œì— ì˜®ê²¨ì¤€ë‹¤.
COPY  ./nginx/nginx.conf /etc/nginx/conf.d/default.conf 

COPY --from=build-stage /app/build /usr/share/nginx/html
CMD ["nginx", "-g", "daemon off;"]# front/nginx/nginx.conf

server {
  listen 80;
  listen [::]:80;

	# server_name ë„ë©”ì¸;
  server_name j6e102.p.ssafy.io;

  access_log /var/log/nginx/access.log;
  error_log /var/log/nginx/error.log;

  location / {
    alias /usr/share/nginx/html;
    try_files $uri $uri/ /index.html;
    return 301 https://$server_name$request_uri; # http ì ‘ì† ì‹œ https ë¡œ ìë™ ì ‘ì†
  }
}

server {
	listen 443 ssl;
	listen [::]:443 ssl;

	# server_name ë„ë©”ì¸;
	server_name  j6e102.p.ssafy.io;

	ssl_certificate /var/www/html/fullchain.pem;
	ssl_certificate_key /var/www/html/privkey.pem;

	root /usr/share/nginx/html;
	index index.html;

	location / {
		try_files $uri $uri/ /index.html;
	}

	location /api {
	    proxy_pass https://j6e102.p.ssafy.io:8443/api;
	}
}

```



## ë°±ì—”ë“œ Dockerfile

> ë¹Œë“œëœ íŒŒì¼ì„ ì‹¤í–‰í•˜ëŠ”ë°ì—ëŠ” JREë§Œ í•„ìš”í•´, ë°°í¬ ì´ë¯¸ì§€ëŠ” JREë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

### dockerfile

```
FROM openjdk:8-jdk-alpine
ARG JAR_FILE=build/libs/*.jar
COPY ${JAR_FILE} app.jar
EXPOSE 8080
ENV TZ=Asia/Seoul
ENTRYPOINT ["java","-jar","/app.jar"]
```



# ğŸ§©Nginx

> frontend ë””ë ‰í„°ë¦¬ ì•ˆ nginx/nginx.conf íŒŒì¼ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. ë°°í¬ëœ í”„ë¡ íŠ¸ì™€ ë°±ì—”ë“œ ì´ë¯¸ì§€ëŠ” ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¡œ ì—°ê²°ë˜ë„ë¡ í•˜ê³ , let'sencryptì™€ certbotì„ ì‚¬ìš©í•´ httpsë¥¼ ì ìš©í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

### nginx config file(/etc/nginx/conf.d/default.conf)

```
# front/nginx/nginx.conf

server {
  listen 80;
  listen [::]:80;

  # server_name ë„ë©”ì¸;
  server_name j6e102.p.ssafy.io;

  access_log /var/log/nginx/access.log;
  error_log /var/log/nginx/error.log;

  location / {
    alias /usr/share/nginx/html;
    try_files $uri $uri/ /index.html;
    return 301 https://$server_name$request_uri; # http ì ‘ì† ì‹œ https ë¡œ ìë™ ì ‘ì†
  }
}

server {
	listen 443 ssl;
	listen [::]:443 ssl;

	# server_name ë„ë©”ì¸;
	server_name  j6e102.p.ssafy.io;

	ssl_certificate /var/www/html/fullchain.pem;
	ssl_certificate_key /var/www/html/privkey.pem;

	root /usr/share/nginx/html;
	index index.html;

	location / {
		try_files $uri $uri/ /index.html;
	}

	location /api {
	    proxy_pass https://j6e102.p.ssafy.io:8443/api;
	}
}

```
